(function(){const S=[{key:"fullName",patterns:[/name/i,/full.?name/i]},{key:"firstName",patterns:[/first.?name/i,/^fname$/i]},{key:"lastName",patterns:[/last.?name/i,/^lname$/i,/surname/i,/family.?name/i]},{key:"email",patterns:[/email/i,/^e-?mail$/i]},{key:"phone",patterns:[/phone/i,/mobile/i,/tel/i,/phone.?number/i]},{key:"company",patterns:[/company/i,/organization/i,/employer/i]},{key:"jobTitle",patterns:[/title/i,/position/i,/role/i]},{key:"address1",patterns:[/^address$/i,/address(?!.*(2|line\s*2))/i,/street/i,/address\s*line\s*1/i]},{key:"address2",patterns:[/address.*(2|line\s*2)/i,/apt|suite|unit/i]},{key:"city",patterns:[/city/i,/town/i]},{key:"state",patterns:[/state/i,/province/i,/region/i]},{key:"zip",patterns:[/zip/i,/postal/i]},{key:"country",patterns:[/country/i]},{key:"website",patterns:[/website/i,/url/i]},{key:"linkedin",patterns:[/linkedin/i]}];function h(t){if(!t)return null;const n=String(t).trim();return/full\s*name/i.test(n)?"fullName":/first\s*name/i.test(n)?"firstName":/last\s*name|surname|family\s*name/i.test(n)?"lastName":/email/i.test(n)?"email":/phone|mobile|tel|phone\s*number/i.test(n)?"phone":/company|organization|employer/i.test(n)?"company":/job\s*title|position|role/i.test(n)?"jobTitle":/address\s*line\s*1|^address$/i.test(n)?"address1":/address\s*line\s*2|apt|suite|unit/i.test(n)?"address2":/city|town/i.test(n)?"city":/state|province|region/i.test(n)?"state":/zip|postal/i.test(n)?"zip":/country/i.test(n)?"country":/website|url/i.test(n)?"website":/linkedin/i.test(n)?"linkedin":null}function C(t){const n=(t.getAttribute("aria-labelledby")||"").trim();return n?n.split(/\s+/).map(r=>{var o,e;return(e=(o=document.getElementById(r))==null?void 0:o.textContent)==null?void 0:e.trim()}).filter(Boolean).join(" "):""}function B(t){var s,l;const n=C(t),r=((l=(s=t.closest('[role="listitem"], .freebirdFormviewerComponentsQuestionBaseRoot, .m2, .o3Dpx'))==null?void 0:s.querySelector('[role="heading"], .freebirdFormviewerComponentsQuestionBaseTitle, label'))==null?void 0:l.textContent)||"",o=[t.getAttribute("name"),t.getAttribute("id"),t.getAttribute("placeholder"),t.getAttribute("aria-label"),t.getAttribute("autocomplete"),n,r].filter(Boolean).join(" ");for(const i of S)if(i.patterns.some(a=>a.test(o)))return i.key;const e=h(o);if(e)return e;switch(t.type){case"email":return"email";case"tel":return"phone";case"url":return"website";default:return null}}function R(t=document){const n=Array.from(t.querySelectorAll('input:not([type=hidden]):not([disabled]), textarea:not([disabled]), select:not([disabled]), [contenteditable="true"]:not([aria-disabled="true"])')),r={};try{t.querySelectorAll('.freebirdFormviewerComponentsQuestionBaseRoot, [role="listitem"].Qr7Oae').forEach(e=>{var a,c;const s=(c=(a=e.querySelector('.freebirdFormviewerComponentsQuestionBaseTitle, [role="heading"], .M7eMe'))==null?void 0:a.textContent)==null?void 0:c.trim(),l=e.querySelector('[role="textbox"], [contenteditable]:not([contenteditable="false"])'),i=h(s);s&&l&&i&&!r[i]&&(r[i]=l)})}catch{}try{t.querySelectorAll('[role="textbox"], [contenteditable]:not([contenteditable="false"])').forEach(e=>{var i,a,c;const s=(c=(a=(i=e.closest('[role="listitem"], .freebirdFormviewerComponentsQuestionBaseRoot, .m2, .o3Dpx'))==null?void 0:i.querySelector('[role="heading"], .freebirdFormviewerComponentsQuestionBaseTitle, .M7eMe, label'))==null?void 0:a.textContent)==null?void 0:c.trim(),l=h(s)||w(e);l&&!r[l]&&(r[l]=e)})}catch{}for(const o of n){const e=o.isContentEditable?w(o):B(o);e&&!r[e]&&(r[e]=o)}try{const o=Object.keys(r);o.length&&console.debug("[SmartFill] Detected fields:",o);const e={inputs:t.querySelectorAll("input:not([type=hidden]):not([disabled])").length,textareas:t.querySelectorAll("textarea:not([disabled])").length,selects:t.querySelectorAll("select:not([disabled])").length,textboxes:t.querySelectorAll('[role="textbox"], [contenteditable]:not([contenteditable="false"])').length};console.debug("[SmartFill] Page controls:",e)}catch{}return r}function q(t,n){var e;const r=t instanceof HTMLTextAreaElement?HTMLTextAreaElement.prototype:HTMLInputElement.prototype,o=Object.getOwnPropertyDescriptor(r,"value");(e=o==null?void 0:o.set)==null||e.call(t,n)}function E(t){try{t.dispatchEvent(new InputEvent("input",{bubbles:!0,composed:!0,data:String(t.value??""),inputType:"insertText"}))}catch{}t.dispatchEvent(new Event("input",{bubbles:!0})),t.dispatchEvent(new Event("change",{bubbles:!0}))}function w(t){var s,l,i;const n=t.getAttribute("aria-label")||((s=t.closest("[aria-label]"))==null?void 0:s.getAttribute("aria-label"))||"",r=C(t),o=((i=(l=t.closest('[role="listitem"], .freebirdFormviewerComponentsQuestionBaseRoot, .m2, .o3Dpx'))==null?void 0:l.querySelector('[role="heading"], .freebirdFormviewerComponentsQuestionBaseTitle, label'))==null?void 0:i.textContent)||"",e=[n,r,o].filter(Boolean).join(" ");for(const a of S)if(a.patterns.some(c=>c.test(e)))return a.key;return h(e)}function A(t,n){if(!n)return{filled:0};let r=0;for(const[o,e]of Object.entries(t)){const s=n[o];if(s!=null){try{e.focus({preventScroll:!0})}catch{}if(e.tagName==="SELECT"){const l=Array.from(e.options).find(i=>{var a,c;return((a=i.value)==null?void 0:a.toLowerCase())===String(s).toLowerCase()||((c=i.text)==null?void 0:c.toLowerCase())===String(s).toLowerCase()});l&&(e.value=l.value,E(e),r++)}else if(e.isContentEditable){try{try{e.click()}catch{}try{e.focus({preventScroll:!0})}catch{}const l=window.getSelection(),i=document.createRange();i.selectNodeContents(e),l.removeAllRanges(),l.addRange(i);try{e.dispatchEvent(new InputEvent("beforeinput",{bubbles:!0,cancelable:!0,inputType:"insertFromPaste",data:String(s)}))}catch{}document.execCommand("selectAll",!1,void 0),document.execCommand("insertText",!1,String(s))||(e.textContent=String(s));try{e.dispatchEvent(new KeyboardEvent("keydown",{key:"Enter",bubbles:!0})),e.dispatchEvent(new KeyboardEvent("keyup",{key:"Enter",bubbles:!0}))}catch{}}catch{e.textContent=String(s)}e.dispatchEvent(new Event("input",{bubbles:!0})),e.dispatchEvent(new Event("change",{bubbles:!0})),r++}else{try{q(e,s)}catch{e.value=s}E(e),r++}try{console.debug("[SmartFill] Filled",o)}catch{}}}try{console.debug("[SmartFill] Total filled:",r)}catch{}return{filled:r}}console.debug("SmartFill content script loaded");function M(){const t="__smartfill_shadow_root__";if(document.getElementById(t))return;const n=document.createElement("div");n.id=t,Object.assign(n.style,{position:"fixed",bottom:"16px",right:"16px",zIndex:2147483647}),document.documentElement.appendChild(n);const r=n.attachShadow({mode:"closed"}),o=document.createElement("button");o.textContent="SmartFill",Object.assign(o.style,{fontFamily:"ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial",background:"#2563eb",color:"#fff",padding:"10px 12px",borderRadius:"9999px",border:"none",boxShadow:"0 4px 12px rgba(0,0,0,0.15)",cursor:"pointer"}),o.onmouseenter=()=>o.style.background="#1e40af",o.onmouseleave=()=>o.style.background="#2563eb",o.addEventListener("click",async()=>{chrome.runtime.sendMessage({type:"AUTOFILL_ACTIVE"})}),r.appendChild(o)}M();function L(t){if(!t)return!0;try{if(t.startsWith("/")&&t.endsWith("/"))return new RegExp(t.slice(1,-1)).test(location.href);const n=new RegExp("^"+t.replace(/[.+^${}()|[\\]\\]/g,"\\$&").replace(/\*/g,".*")+"$");return n.test(location.host)||n.test(location.href)}catch{return!1}}function Q(t=[],n={}){const r={},o=t.filter(e=>L(e.sitePattern));for(const e of o)try{if(e.selector&&document.querySelectorAll(e.selector).forEach(l=>{const i=e.key;i&&!r[i]&&(r[i]=l)}),e.labelRegex){const s=new RegExp(e.labelRegex,"i");document.querySelectorAll('[role="textbox"], [contenteditable]:not([contenteditable="false"]), input, textarea, select').forEach(i=>{var b,m,u;const a=((u=(m=(b=i.closest('[role="listitem"], .freebirdFormviewerComponentsQuestionBaseRoot, .m2, .o3Dpx'))==null?void 0:b.querySelector('[role="heading"], .freebirdFormviewerComponentsQuestionBaseTitle, .M7eMe, label'))==null?void 0:m.textContent)==null?void 0:u.trim())||"",c=i.getAttribute("aria-label")||i.placeholder||"";if(s.test(a)||s.test(c)){const d=e.key;d&&!r[d]&&(r[d]=i)}})}if(e.selector&&e.value!=null&&!e.key){const s=document.querySelector(e.selector);s&&A({__fixed:s},{__fixed:e.value})}}catch{}return r}chrome.runtime.onMessage.addListener((t,n,r)=>{var o;if((t==null?void 0:t.type)==="AUTOFILL"){const e=Q(t.rules||[],t.profile),s=R(document),l={},i=Array.isArray((o=t==null?void 0:t.profile)==null?void 0:o.customFields)?t.profile.customFields:[];if(i.length)try{const u=document.querySelectorAll('[role="textbox"], [contenteditable]:not([contenteditable="false"]), input, textarea, select');i.forEach(d=>{const f=String((d==null?void 0:d.name)||"").trim();if(!f||l[f])return;const x=new RegExp(`(^|\\b)${f.replace(/[-/\\^$*+?.()|[\]{}]/g,"\\$&")}($|\\b)`,"i");let p=null;u.forEach(y=>{var g,v,k;const F=((k=(v=(g=y.closest('[role="listitem"], .freebirdFormviewerComponentsQuestionBaseRoot, .m2, .o3Dpx'))==null?void 0:g.querySelector('[role="heading"], .freebirdFormviewerComponentsQuestionBaseTitle, .M7eMe, label'))==null?void 0:v.textContent)==null?void 0:k.trim())||"",T=y.getAttribute("aria-label")||y.placeholder||"";(x.test(F)||x.test(T))&&(p||(p=y))}),p&&(l[f]=p)})}catch{}const a={...s,...l,...e},c=Object.fromEntries(i.filter(u=>u==null?void 0:u.name).map(u=>[u.name,u.value])),b={...t.profile,...c},{filled:m}=A(a,b);r({ok:!0,filled:m})}});
})()
